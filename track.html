<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SepetTaxi â€“ CanlÄ± Takip</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; margin:0; padding:15px; background:#f4f4f4; }
#map { width:100%; height:60vh; background:#ddd; border-radius:8px; }
.status { margin:10px 0; font-size:14px; }
</style>
</head>

<body>

<h3>ğŸš• CanlÄ± Takip</h3>
<div class="status" id="status">Job aranÄ±yorâ€¦</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<script>
/* ===============================
   AYAR
================================ */
const API_URL = "https://script.google.com/macros/s/AKfycbzj7yAEHRbMus-F0Un-PH_9ogviUOLLplHPXR6NfWZ1c-vqHwInuOj8i5_wL8vMURqR/exec";
const jobId = new URLSearchParams(window.location.search).get("job_id");

const map = L.map("map").setView([40.195,29.060], 13);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

let driverMarker;

/* ===============================
   JOB OKU
================================ */
function loadJob(){
  fetch(API_URL + "?action=getJob&job_id=" + jobId)
    .then(r => r.json())
    .then(j => {
      if(!j || !j.driver_lat){
        document.getElementById("status").innerText =
          "Job bulundu ama sÃ¼rÃ¼cÃ¼ konumu yok";
        return;
      }

      document.getElementById("status").innerText =
        "SÃ¼rÃ¼cÃ¼ yolda âœ” | status=" + j.status;

      if(!driverMarker){
        driverMarker = L.marker([j.driver_lat,j.driver_lng]).addTo(map);
      } else {
        driverMarker.setLatLng([j.driver_lat,j.driver_lng]);
      }

      map.setView([j.driver_lat,j.driver_lng],15);
    })
    .catch(() => {
      document.getElementById("status").innerText =
        "Job bulunamadÄ± âŒ";
    });
}

setInterval(loadJob, 3000);
</script>

</body>
</html>
