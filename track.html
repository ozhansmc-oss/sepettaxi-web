<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SepetTaxi – Canlı Takip</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
#map{height:100vh}
.badge{position:absolute;top:10px;left:10px;background:#000;padding:10px;border-radius:10px}
</style>
</head>
<body>

<div id="map"></div>
<div class="badge">Canlı Takip</div>

<script>
const BACKEND="https://script.google.com/macros/s/AKfycbxMLho3ZDX1R4EvZz-9MrOOq44807vH0MFd_X8ypSrYB6-vAQAR_dPa-lprAGkR1xsDxQ/exec";
const jobId=new URLSearchParams(location.search).get("job_id");

const map=L.map("map").setView([41,29],14);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let marker=null;

async function poll(){
  const r=await fetch(`${BACKEND}?action=getLive&job_id=${jobId}`);
  const d=await r.json();
  if(!d.lat) return;
  const p=[d.lat,d.lng];
  if(!marker){
    marker=L.marker(p).addTo(map);
    map.setView(p,16);
  }else{
    marker.setLatLng(p);
  }
}

setInterval(poll,3000);
</script>

</body>
</html>
