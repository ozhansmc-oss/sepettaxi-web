<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>CanlÄ± Takip</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>#map{height:80vh}</style>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
</head>
<body>

<h3>ğŸš• CanlÄ± Takip</h3>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx8el5RvTxWIWZfAIdvhm8q8AYOejPPYRmzFbIoD5mCMUVhT-p2XCH3ixm-gXl23jKv/exec";
const jobId = new URLSearchParams(location.search).get("job_id");

const map = L.map("map").setView([40.19,29.06],13);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
let marker;

setInterval(()=>{
  fetch(API_URL+"?action=getJob&job_id="+jobId)
    .then(r=>r.json())
    .then(j=>{
      if(!j.driver_lat) return;
      if(!marker){
        marker = L.marker([j.driver_lat,j.driver_lng]).addTo(map);
      }else{
        marker.setLatLng([j.driver_lat,j.driver_lng]);
      }
      map.setView([j.driver_lat,j.driver_lng],15);
    });
},3000);
</script>

</body>
</html>
