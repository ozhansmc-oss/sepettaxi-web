<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SepetTaxi – Canlı Takip</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
html,body,#map{height:100%;margin:0}
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
/* ================== AYAR ================== */
const API_URL = "https://script.google.com/macros/s/AKfycbxmjbl9o0881xyp8EV4IgKFI72GDpAw8GtT4OS-uOnMzkGloQn8C_C6A9q5mMIEsBSy/exec";
/* ========================================= */

const jobId = new URLSearchParams(window.location.search).get("job_id");

if (!jobId) {
  alert("Job ID bulunamadı");
}

/* Harita */
const map = L.map("map").setView([40.195, 29.060], 13);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

let driverMarker = L.marker([40.195, 29.060]).addTo(map);

/* Canlı takip */
setInterval(() => {
  fetch(API_URL + "?action=getJob&id=" + jobId)
    .then(r => r.json())
    .then(j => {
      if (j.driver_lat && j.driver_lng) {
        driverMarker.setLatLng([j.driver_lat, j.driver_lng]);
        map.panTo([j.driver_lat, j.driver_lng]);
      }
    });
}, 5000);
</script>

</body>
</html>
