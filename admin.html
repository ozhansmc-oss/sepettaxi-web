<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SepetTaxi ‚Äì Admin</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#050506;
  color:#fff;
}
header{
  height:60px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:22px;
  border-bottom:1px solid rgba(255,255,255,.1);
}
header span{color:#f5c400}

#login,#panel{
  max-width:720px;
  margin:20px auto;
  padding:16px;
}
input,button{
  width:100%;
  height:48px;
  margin-top:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#000;
  color:#fff;
  font-size:16px;
}
button{
  background:linear-gradient(#ffd84a,#f5c400);
  color:#000;
  font-weight:900;
  cursor:pointer;
}
.list{
  margin-top:16px;
}
.card{
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:12px;
  margin-bottom:12px;
}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}
.badge.taxi{background:#f5c400;color:#000}
.badge.courier{background:#31d07b;color:#000}
.row{
  display:flex;
  gap:10px;
  margin-top:10px;
}
.btn-red{
  background:#ff3b3b;
  color:#fff;
}
.small{
  font-size:13px;
  opacity:.7;
}
</style>
</head>

<body>

<header>Sepet<span>Taxi</span> Admin</header>

<div id="login">
  <h3>Admin Giri≈ü</h3>
  <input id="pin" placeholder="Admin PIN">
  <button onclick="login()">Giri≈ü</button>
</div>

<div id="panel" style="display:none">
  <h3>Bekleyen S√ºr√ºc√º Ba≈üvurularƒ±</h3>
  <div class="list" id="list"></div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycby1ekP3NTaDt0AtRiQG3CrA4iiz9MYLSsWko4mIPsjdUwBWbAJpCp-k250W3O_GnoBxzg/exec";
let ADMIN_PIN = "";

function login(){
  ADMIN_PIN = document.getElementById("pin").value.trim();
  if(!ADMIN_PIN){
    alert("PIN girin");
    return;
  }
  document.getElementById("login").style.display="none";
  document.getElementById("panel").style.display="block";
  loadApplications();
}

async function loadApplications(){
  const res = await fetch(`${API}?action=adminGetDriverApplications&admin_pin=${ADMIN_PIN}&status=pending`);
  const data = await res.json();

  if(!data.ok){
    alert("Yetki hatasƒ±");
    location.reload();
    return;
  }

  const list = document.getElementById("list");
  list.innerHTML = "";

  if(data.applications.length === 0){
    list.innerHTML = "<p class='small'>Bekleyen ba≈üvuru yok.</p>";
    return;
  }

  data.applications.forEach(app=>{
    const div = document.createElement("div");
    div.className="card";

    div.innerHTML = `
      <strong>${app.name}</strong><br>
      <span class="small">${app.phone}</span><br>
      <span class="badge ${app.vehicle_type}">
        ${app.vehicle_type === "taxi" ? "üöï Taksi" : "üèçÔ∏è Kurye"}
      </span>
      <div class="row">
        <button onclick="approve('${app.application_id}')">Kabul</button>
        <button class="btn-red" onclick="reject('${app.application_id}')">Red</button>
      </div>
    `;
    list.appendChild(div);
  });
}

async function approve(id){
  if(!confirm("S√ºr√ºc√º kabul edilsin mi?")) return;

  const res = await fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"adminApproveDriver",
      admin_pin:ADMIN_PIN,
      application_id:id
    })
  });
  const data = await res.json();
  if(data.ok){
    loadApplications();
  }else{
    alert("Hata: " + data.error);
  }
}

async function reject(id){
  const note = prompt("Red sebebi (opsiyonel):","");

  const res = await fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      action:"adminRejectDriver",
      admin_pin:ADMIN_PIN,
      application_id:id,
      notes:note
    })
  });
  const data = await res.json();
  if(data.ok){
    loadApplications();
  }else{
    alert("Hata: " + data.error);
  }
}
</script>

</body>
</html>
