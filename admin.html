<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SepetTaxi – Admin</title>
<meta name="theme-color" content="#f5c400">

<style>
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  background:#050506;color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif
}
:root{
  --y:#f5c400;
  --card:#141416;
  --line:rgba(255,255,255,.10);
  --mut:rgba(255,255,255,.65);
  --ok:#3ddc97;
  --bad:#ff5a5f;
}

/* HEADER */
header{
  height:56px;display:flex;align-items:center;justify-content:space-between;
  padding:0 14px;border-bottom:1px solid var(--line)
}
header .t{font-weight:1000}

/* MAIN */
main{padding:12px}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:18px;padding:12px;margin-bottom:12px
}
.card h3{margin:0 0 8px;font-size:14px}

/* LOGIN */
input,textarea{
  width:100%;padding:12px;border-radius:14px;
  background:#0f0f10;border:1px solid var(--line);
  color:#fff;outline:none
}
button{
  width:100%;padding:14px;border-radius:16px;
  background:linear-gradient(180deg,var(--y),#d9aa00);
  border:0;font-weight:1000;margin-top:10px;cursor:pointer
}
button.secondary{
  background:rgba(255,255,255,.06);
  color:#fff;border:1px solid var(--line)
}
button.danger{
  background:rgba(255,90,95,.15);
  border:1px solid rgba(255,90,95,.4);
  color:#ff5a5f
}

/* APPLICATION */
.app{
  padding:12px;border-radius:16px;
  background:rgba(255,255,255,.04);
  border:1px solid var(--line);
  margin-bottom:8px
}
.app .t{font-weight:900}
.app .s{font-size:12px;color:var(--mut);margin-top:4px}
.app .row{display:flex;gap:8px;margin-top:8px}
.app .row button{flex:1}
</style>
</head>

<body>

<header>
  <div class="t">Admin Panel</div>
</header>

<main>

<!-- ADMIN LOGIN -->
<div class="card" id="loginCard">
  <h3>Admin Girişi</h3>
  <input id="adminPin" placeholder="Admin PIN">
  <button id="btnLogin">Giriş Yap</button>
</div>

<!-- APPLICATIONS -->
<div class="card" id="appsCard" style="display:none">
  <h3>Bekleyen Sürücü Başvuruları</h3>
  <div id="apps"></div>
</div>

</main>

<script>
/* ================= CONFIG ================= */
const API="https://script.google.com/macros/s/AKfycbz5Qk4OSBwQ1NCf09EGfczk7I8d3pRUSihE6xpb69mFRSf-MfNactwUxEQrNBYh6GcM/exec";
let ADMIN_PIN="";

/* ================= API ================= */
async function api(action,payload){
  const r=await fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({action,...payload})
  });
  const j=await r.json();
  if(!j.ok) throw new Error(j.error||"API_ERROR");
  return j;
}

/* ================= LOGIN ================= */
btnLogin.onclick=async()=>{
  ADMIN_PIN = adminPin.value.trim();
  if(!ADMIN_PIN){ alert("PIN gerekli"); return; }
  try{
    await loadApps();
    loginCard.style.display="none";
    appsCard.style.display="block";
  }catch(e){
    alert("Giriş başarısız: "+e.message);
  }
};

/* ================= LOAD APPLICATIONS ================= */
async function loadApps(){
  const r = await api("adminGetDriverApplications",{
    admin_pin: ADMIN_PIN,
    status: "pending"
  });
  renderApps(r.applications||[]);
}

/* ================= RENDER ================= */
function renderApps(list){
  apps.innerHTML="";
  if(!list.length){
    apps.innerHTML="<div style='font-size:12px;color:#888'>Bekleyen başvuru yok</div>";
    return;
  }
  list.forEach(a=>{
    const d=document.createElement("div");
    d.className="app";
    d.innerHTML=`
      <div class="t">${a.name}</div>
      <div class="s">${a.phone} • ${a.vehicle_type}</div>
      <div class="s">Başvuru: ${a.submitted_at}</div>
      <textarea placeholder="Red notu (opsiyonel)" style="margin-top:6px"></textarea>
      <div class="row">
        <button class="secondary">Onayla</button>
        <button class="danger">Reddet</button>
      </div>
    `;
    const note = d.querySelector("textarea");
    d.querySelector(".secondary").onclick=()=>approve(a.application_id);
    d.querySelector(".danger").onclick=()=>reject(a.application_id, note.value);
    apps.appendChild(d);
  });
}

/* ================= ACTIONS ================= */
async function approve(id){
  if(!confirm("Başvuru onaylansın mı?")) return;
  try{
    await api("adminApproveDriver",{
      admin_pin: ADMIN_PIN,
      application_id: id
    });
    loadApps();
  }catch(e){
    alert("Onaylanamadı: "+e.message);
  }
}
async function reject(id, note){
  if(!confirm("Başvuru reddedilsin mi?")) return;
  try{
    await api("adminRejectDriver",{
      admin_pin: ADMIN_PIN,
      application_id: id,
      notes: note
    });
    loadApps();
  }catch(e){
    alert("Reddedilemedi: "+e.message);
  }
}
</script>

</body>
</html>
