<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SepetTaxi â€“ Admin</title>

<script src="config.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#0b0b0b;color:#fff}
.hidden{display:none}
header{height:56px;display:flex;align-items:center;justify-content:center;font-weight:900;border-bottom:1px solid #222}
header span{color:#f5c400}

#loginWrap{height:100vh;display:flex;align-items:center;justify-content:center}
.loginCard{background:#111;border-radius:18px;padding:20px;width:100%;max-width:340px;border:1px solid #222}
.loginCard h1{text-align:center;margin:0 0 14px 0}
.loginCard h1 span{color:#f5c400}
.loginCard input{width:100%;padding:14px;border-radius:14px;border:0;background:#222;color:#fff;margin-bottom:10px}
.loginCard button{width:100%;padding:14px;border-radius:18px;border:0;font-weight:900;background:#f5c400;color:#000}
.err{color:#ff6b6b;font-size:13px;text-align:center;display:none}

.wrap{padding:14px;max-width:1200px;margin:auto}
.card{background:#111;border-radius:16px;padding:14px;margin-bottom:14px;border:1px solid #222}
.btnSmall{background:#f5c400;border:0;border-radius:12px;padding:8px 10px;font-weight:900;cursor:pointer}
.btnRed{background:#6f1f1f;color:#fff}
.small{font-size:12px;color:#aaa}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginWrap">
  <div class="loginCard">
    <h1>Sepet<span>Taxi</span></h1>
    <input id="aid" placeholder="Admin ID">
    <input id="pin" type="password" placeholder="PIN">
    <button onclick="login()">GÄ°RÄ°Åž</button>
    <div id="err" class="err">HatalÄ± giriÅŸ</div>
  </div>
</div>

<!-- ADMIN -->
<div id="adminWrap" class="hidden">
<header>Sepet<span>Taxi</span> â€“ Admin</header>

<div class="wrap">

  <div class="card">
    <b>SÃ¼rÃ¼cÃ¼ AdaylarÄ± (Onay Bekleyen)</b>
    <div id="candidates" class="small" style="margin-top:10px">YÃ¼kleniyorâ€¦</div>
  </div>

</div>
</div>

<script>
const BACKEND_URL = SEPT.BACKEND_URL;
const ADMIN_ID="admin";
const ADMIN_PIN="1234";
const $=id=>document.getElementById(id);

/* ===== AUTH ===== */
function login(){
  if($("aid").value.trim()===ADMIN_ID && $("pin").value.trim()===ADMIN_PIN){
    sessionStorage.setItem("admin_auth","ok");
    showAdmin();
  }else{
    $("err").style.display="block";
  }
}
function showAdmin(){
  $("loginWrap").classList.add("hidden");
  $("adminWrap").classList.remove("hidden");
  loadDrivers();
  setInterval(loadDrivers,5000);
}
if(sessionStorage.getItem("admin_auth")==="ok") showAdmin();

/* ===== API ===== */
async function apiPost(action,payload){
  return fetch(BACKEND_URL,{
    method:"POST",
    headers:{ "Content-Type":"text/plain;charset=utf-8" },
    body:JSON.stringify(Object.assign({action},payload||{}))
  }).then(r=>r.json());
}

/* ===== DRIVERS ===== */
async function loadDrivers(){
  const res = await apiPost("adminListDrivers",{});
  if(!res.ok) return;
  renderCandidates(res.drivers||[]);
}

function renderCandidates(drivers){
  const pending = drivers.filter(d=>d.status==="pending");
  if(!pending.length){
    $("candidates").innerText="Onay bekleyen sÃ¼rÃ¼cÃ¼ yok.";
    return;
  }
  $("candidates").innerHTML = pending.map(d=>`
    <div style="margin-bottom:12px">
      <b>${d.name}</b><br>
      ðŸ“ž ${d.phone}<br>
      ðŸš— ${d.vehicle_type}<br>
      ðŸ†” ${d.driver_id}<br>
      <button class="btnSmall" onclick="approve('${d.driver_id}')">ONAYLA</button>
      <button class="btnSmall btnRed" onclick="reject('${d.driver_id}')">REDDET</button>
    </div>
  `).join("");
}

async function approve(id){
  await apiPost("adminApproveDriver",{driver_id:id});
  loadDrivers();
}
async function reject(id){
  await apiPost("adminRejectDriver",{driver_id:id});
  loadDrivers();
}
</script>

</body>
</html>

