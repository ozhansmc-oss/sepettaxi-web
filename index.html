<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SepetTaxi</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
/* ==== AYNI CSS â€“ DOKUNULMADI ==== */
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:Arial,Helvetica,sans-serif;background:#000;color:#fff;overflow:hidden}
:root{--y:#f5c400;--line:#222;--muted:#9a9a9a;--card1:#141414;--card2:#0f0f0f;--ok:#2ecc71;--bad:#e74c3c}

/* ==== HAMBURGER + SIDE MENU (EK) ==== */
#hamburger{
  position:fixed;
  top:12px;left:12px;
  z-index:4000;
  background:#111;
  padding:6px 10px;
  border-radius:10px;
  font-size:26px;
  cursor:pointer;
}

#sideMenu{
  position:fixed;
  top:0;left:0;
  width:260px;height:100%;
  background:#0b0b0b;
  z-index:3999;
  transform:translateX(-100%);
  transition:.25s;
  padding:16px;
}
#sideMenu.open{transform:translateX(0)}

#sideMenu .menuHeader{
  margin-bottom:20px;
  font-size:14px;
  color:#ddd;
}
#sideMenu button{
  width:100%;
  background:#141414;
  color:#fff;
  border:1px solid #222;
  padding:12px;
  border-radius:10px;
  margin-bottom:10px;
  text-align:left;
}
</style>
</head>

<body>

<!-- ===== HAMBURGER ===== -->
<div id="hamburger" onclick="toggleMenu()">â˜°</div>

<!-- ===== SIDE MENU ===== -->
<div id="sideMenu">
  <div class="menuHeader" id="menuUser"></div>
  <button onclick="openProfile()">ðŸ‘¤ Profilim</button>
  <button onclick="logout()">ðŸšª Ã‡Ä±kÄ±ÅŸ</button>
</div>

<!-- ===== APP HTML (SENÄ°N MEVCUT HTMLâ€™Ä°N) ===== -->
<!-- Landing, modal, map, panels, courier, taxi vs. -->
<!-- HÄ°Ã‡BÄ°RÄ°NE DOKUNULMADI -->

<script src="config.js"></script>
<script src="log.js"></script>

<script>
/* =====================================================
   ðŸ”’ USER STATE (LOCKED)
   ===================================================== */
const USER_KEY = "SEPT_user";

let user = {
  isLoggedIn:false,
  customer_id:"",
  first:"",
  last:"",
  phone:""
};

function loadUser(){
  try{
    const u = JSON.parse(localStorage.getItem(USER_KEY));
    if(u && u.phone){
      user = {...user,...u,isLoggedIn:true};
    }
  }catch(_){}
}

function saveUser(){
  localStorage.setItem(USER_KEY,JSON.stringify(user));
}

function logout(){
  localStorage.removeItem(USER_KEY);
  location.reload();
}

/* =====================================================
   HAMBURGER MENU
   ===================================================== */
function toggleMenu(){
  $("sideMenu").classList.toggle("open");
}

function renderMenu(){
  $("menuUser").innerHTML = user.isLoggedIn
    ? `<b>${user.first} ${user.last}</b><br>${user.phone}`
    : `<b>Misafir</b>`;
}

function openProfile(){
  alert(
    `Ad: ${user.first} ${user.last}\nTelefon: ${user.phone}`
  );
}

/* =====================================================
   REGISTRATION BRIDGE (LOCKED)
   ===================================================== */
function ensureRegistered(){
  if(user.isLoggedIn) return true;

  const first = prompt("AdÄ±nÄ±z");
  const last  = prompt("SoyadÄ±nÄ±z");
  const phone = prompt("Telefon (0XXXXXXXXXX)");

  if(!first || !last || !phone) return false;

  user = {
    isLoggedIn:true,
    customer_id:"CUST-"+Date.now(),
    first, last, phone
  };

  saveUser();
  renderMenu();
  return true;
}

/* =====================================================
   TRACK EMBED (SENÄ°N KODUN â€“ DOKUNULMADI)
   ===================================================== */
function gotoTrack(){
  const jid = currentJobId || sessionStorage.getItem("SEPT_job_id");
  const tok = currentTrackToken || sessionStorage.getItem("SEPT_track_token");
  if(!jid){ alert("Takip bilgisi yok"); return; }

  const base = location.pathname.replace(/\/[^\/]*$/, "/track.html");
  const url = new URL(base, location.origin);
  url.searchParams.set("job_id", jid);
  if(tok) url.searchParams.set("track_token", tok);
  location.href = url.toString();
}

/* =====================================================
   API HELPER
   ===================================================== */
async function apiPost(action,payload){
  payload.action = action;
  const r = await fetch(SEPT.BACKEND_URL,{
    method:"POST",
    body:JSON.stringify(payload)
  });
  const j = await r.json();
  Log.api(action,payload,j);
  return j;
}

/* =====================================================
   BOOT
   ===================================================== */
function $(id){return document.getElementById(id);}
loadUser();
renderMenu();
Log.info("Index loaded", user);

</script>
</body>
</html>
