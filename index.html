<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SepetTaxi</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="config.js"></script>

<style>
*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:Arial,Helvetica,sans-serif;background:#000;color:#fff;overflow:hidden}
:root{--y:#f5c400;--line:#222;--muted:#9a9a9a;--card:#141414}

.hidden{display:none}
header{height:56px;display:flex;align-items:center;justify-content:center;font-weight:900;border-bottom:1px solid #222}
header span{color:var(--y)}

#map{height:50vh}
.wrap{padding:12px}

.cardRow{display:flex;gap:10px;margin-bottom:10px}
.card{
  flex:1;
  background:var(--card);
  border-radius:16px;
  padding:14px;
  border:1px solid #222;
  cursor:pointer
}
.card.outline{background:#0f0f0f}
.card b{display:block;margin-bottom:4px}
.muted{font-size:12px;color:var(--muted)}

button{
  width:100%;
  padding:14px;
  border-radius:18px;
  border:0;
  font-weight:900;
  background:var(--y);
  color:#000;
  margin-top:10px;
  cursor:pointer
}
button.ghost{
  background:#111;
  color:#fff;
  border:1px solid #222
}

input,select{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:0;
  background:#222;
  color:#fff;
  margin-top:8px
}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.7);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:5000
}
.modalCard{
  background:#111;
  border-radius:18px;
  padding:20px;
  width:100%;
  max-width:340px;
  border:1px solid #222
}
</style>
</head>

<body>

<header>Sepet<span>Taxi</span></header>

<div id="map"></div>

<div class="wrap">

  <!-- MÃœÅTERÄ° KARTLARI -->
  <div class="cardRow">
    <div class="card">
      <b>ğŸš• Taksi Ã‡aÄŸÄ±r</b>
      <div class="muted">HÄ±zlÄ± ve gÃ¼venli yolculuk</div>
    </div>
    <div class="card">
      <b>ğŸ“¦ Kurye Ã‡aÄŸÄ±r</b>
      <div class="muted">GÃ¶nderini hemen ulaÅŸtÄ±ralÄ±m</div>
    </div>
  </div>

  <!-- SÃœRÃœCÃœ KARTLARI -->
  <div class="cardRow">
    <div class="card" onclick="goDriverLogin()">
      <b>ğŸš• SÃ¼rÃ¼cÃ¼ mÃ¼sÃ¼n?</b>
      <div class="muted">Driver ID ile panele gir</div>
    </div>
    <div class="card outline" onclick="openDriverApply()">
      <b>â• SÃ¼rÃ¼cÃ¼ Ol</b>
      <div class="muted">SepetTaxi sÃ¼rÃ¼cÃ¼sÃ¼ olmak iÃ§in baÅŸvur</div>
    </div>
  </div>

</div>

<!-- ================= DRIVER APPLY MODAL ================= -->
<div id="driverApplyModal" class="modal hidden">
  <div class="modalCard">
    <h3>SÃ¼rÃ¼cÃ¼ BaÅŸvurusu</h3>

    <input id="drvName" placeholder="Ad Soyad">
    <input id="drvPhone" placeholder="Telefon (0XXXXXXXXXX)" maxlength="11">
    <select id="drvVehicle">
      <option value="taxi">Taksi</option>
      <option value="courier">Kurye</option>
    </select>

    <button onclick="submitDriverApply()">BaÅŸvuruyu GÃ¶nder</button>
    <button class="ghost" onclick="closeDriverApply()">VazgeÃ§</button>

    <div id="drvMsg" class="muted" style="margin-top:10px"></div>
  </div>
</div>

<script>
/* ================= MAP ================= */
const map = L.map("map").setView([40.195,29.060],12);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

/* ================= HELPERS ================= */
const $ = id => document.getElementById(id);

/* ================= DRIVER FLOW ================= */
function goDriverLogin(){
  location.href = "driver.html";
}

function openDriverApply(){
  $("driverApplyModal").classList.remove("hidden");
  $("drvMsg").innerText = "";
}

function closeDriverApply(){
  $("driverApplyModal").classList.add("hidden");
}

async function submitDriverApply(){
  const name = $("drvName").value.trim();
  const phone = $("drvPhone").value.replace(/\D/g,"");
  const vehicle = $("drvVehicle").value;

  if(name.length < 3){
    $("drvMsg").innerText = "Ad soyad gerekli.";
    return;
  }
  if(phone.length !== 11 || !phone.startsWith("0")){
    $("drvMsg").innerText = "Telefon 0 ile baÅŸlayan 11 haneli olmalÄ±.";
    return;
  }

  $("drvMsg").innerText = "BaÅŸvurun gÃ¶nderiliyorâ€¦";

  const res = await fetch(SEPT.BACKEND_URL,{
    method:"POST",
    body:JSON.stringify({
      action:"registerDriver",
      name,
      phone,
      vehicle_type:vehicle
    })
  }).then(r=>r.json());

  if(!res.ok){
    $("drvMsg").innerText = res.error || "BaÅŸvuru alÄ±namadÄ±.";
    return;
  }

  if(res.status==="pending"){
    $("drvMsg").innerText =
      "BaÅŸvurun alÄ±ndÄ±. OnaylandÄ±ÄŸÄ±nda SMS ile bilgilendirileceksin.";
  }else if(res.status==="available"){
    $("drvMsg").innerText =
      "Zaten onaylÄ± bir sÃ¼rÃ¼cÃ¼sÃ¼n. Driver ID ile giriÅŸ yapabilirsin.";
  }else if(res.status==="rejected"){
    $("drvMsg").innerText =
      "Daha Ã¶nce reddedilmiÅŸ bir baÅŸvurun bulunuyor.";
  }
}
</script>

</body>
</html>
