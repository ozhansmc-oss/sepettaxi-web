<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SepetTaxi</title>
<meta name="theme-color" content="#f5c400">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
*{box-sizing:border-box}
:root{
  --y:#f5c400;
  --bg:#050506;
  --panel:#0f0f10;
  --card:#141416;
  --line:rgba(255,255,255,.10);
  --mut:rgba(255,255,255,.65);
}
html,body{
  margin:0;height:100%;
  background:var(--bg);color:#fff;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  overflow:hidden;
}

/* TOPBAR */
.topbar{
  height:56px;display:flex;align-items:center;justify-content:space-between;
  padding:0 12px;border-bottom:1px solid var(--line);
  background:rgba(5,5,6,.95);
  position:fixed;top:0;left:0;right:0;z-index:5000;
}
.brand{font-weight:900;font-size:18px}
.brand b{color:var(--y)}
.iconBtn{
  width:38px;height:38px;border-radius:14px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.06);
  color:#fff;
}

/* DRAWER */
.drawerBack{
  position:fixed;inset:0;z-index:7000;
  background:rgba(0,0,0,.6);display:none;
}
.drawer{
  position:absolute;right:0;top:0;height:100%;
  width:320px;max-width:85vw;
  background:#0f0f10;border-left:1px solid var(--line);
  padding:14px;
}
.drawer h3{margin:0 0 10px}
.menuItem{
  padding:12px;border-radius:16px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.04);
  margin-bottom:10px;
}

/* LAYOUT */
.wrap{position:fixed;inset:56px 0 0 0;display:flex;flex-direction:column}
#map{height:50vh;border-bottom:1px solid var(--line)}
.panel{height:calc(50vh - 56px);padding:12px;background:var(--panel)}
.leaflet-control-container{display:none}

/* CARD */
.card{
  height:100%;
  display:flex;flex-direction:column;
  border:1px solid var(--line);
  background:rgba(255,255,255,.04);
  border-radius:20px;padding:12px;
}
.cardBody{flex:1;overflow:hidden}
.cardFooter{
  position:sticky;bottom:0;padding-top:10px;
  background:linear-gradient(180deg,rgba(15,15,16,.6),rgba(15,15,16,.95));
}

.label{font-size:11px;color:var(--mut);margin:6px 0}
.input{
  width:100%;height:46px;border-radius:16px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.06);
  color:#fff;padding:0 12px;
}
.metrics{display:flex;gap:10px;margin-top:10px}
.metric{flex:1;border:1px solid var(--line);border-radius:16px;padding:10px}
.metric b{font-size:18px}

.btn{
  height:52px;border-radius:18px;
  border:1px solid var(--line);
  background:rgba(255,255,255,.06);
  color:#fff;font-weight:900;
}
.btn.primary{background:#f5c400;color:#000}
.cta{display:flex;gap:10px;margin-top:8px}
.tiny{font-size:12px;color:var(--mut);margin-top:6px}

/* MODALS */
.modalBack{
  position:fixed;inset:0;z-index:9000;
  background:rgba(0,0,0,.65);display:none;
}
.modal{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:min(420px,92vw);
  background:#111;border-radius:20px;
  padding:14px;border:1px solid var(--line);
}

/* SEARCH */
.searchOverlay{
  position:fixed;inset:0;z-index:9500;
  background:rgba(0,0,0,.55);display:none;
}
.searchCard{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  background:#141414;border-radius:20px;
  padding:16px;border:1px solid var(--line);
}
.badge{
  padding:10px 14px;border-radius:999px;
  background:rgba(245,196,0,.15);
  border:1px solid rgba(245,196,0,.35);
  font-weight:900;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="brand">Sepet<b>Taxi</b></div>
  <button class="iconBtn" id="btnMenu">≡</button>
</div>

<div class="drawerBack" id="drawerBack">
  <div class="drawer">
    <h3>Menü</h3>
    <div class="menuItem" onclick="go('driver.html')">Sürücü Girişi</div>
    <div class="menuItem" onclick="go('admin.html')">Admin</div>
    <div class="menuItem" onclick="go('contracts/user.html')">Kullanıcı Sözleşmesi</div>
    <div class="menuItem" onclick="go('contracts/driver.html')">Sürücü Sözleşmesi</div>
    <div class="menuItem" onclick="go('contracts/privacy.html')">Gizlilik Politikası</div>
  </div>
</div>

<div class="wrap">
  <div id="map"></div>
  <div class="panel">
    <div class="card">

      <div class="cardBody">
        <div class="label">Nereden</div>
        <input id="fromInput" class="input">

        <div class="label">Nereye</div>
        <input id="toInput" class="input">

        <div class="metrics" id="metrics" style="display:none">
          <div class="metric"><small>Mesafe</small><b id="mDist">—</b></div>
          <div class="metric"><small>Ücret</small><b id="mPrice">—</b></div>
        </div>
      </div>

      <div class="cardFooter">
        <div class="cta">
          <button class="btn" id="btnRegister">Kayıt</button>
          <button class="btn primary" id="btnCall">Taksi Çağır</button>
        </div>
        <div class="tiny" id="callNote">Adresleri seçince mesafe ve ücret hesaplanır.</div>
      </div>

    </div>
  </div>
</div>

<div class="modalBack" id="regBack">
  <div class="modal">
    <h3>Zorunlu Kayıt</h3>
    <input id="rFirst" class="input" placeholder="Ad">
    <input id="rLast" class="input" placeholder="Soyad">
    <input id="rPhone" class="input" placeholder="Telefon">
    <div class="cta">
      <button class="btn" onclick="closeReg()">Vazgeç</button>
      <button class="btn primary" onclick="saveReg()">Kaydet</button>
    </div>
  </div>
</div>

<div class="searchOverlay" id="search">
  <div class="searchCard">
    <div class="badge">Sürücü aranıyor…</div>
  </div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzQ5Nw3WJlOTkC5vrjQHyykHT3En-jmSkcdoBvgUC4v49n-MFFZhfKDBQ4Z1ehRLyWG/exec";
let map,fromM,toM,customer=load();

function $(i){return document.getElementById(i)}
function go(u){location.href=u}

function load(){try{return JSON.parse(localStorage.getItem("sepettaxi_customer"))}catch(e){return null}}
function save(c){localStorage.setItem("sepettaxi_customer",JSON.stringify(c))}

function init(){
  map=L.map("map",{zoomControl:false,attributionControl:false}).setView([40.19,29.06],13);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
  map.on("click",e=>{
    if(!fromM){fromM=L.marker(e.latlng).addTo(map);$("fromInput").value="Seçildi"}
    else if(!toM){toM=L.marker(e.latlng).addTo(map);$("toInput").value="Seçildi";calc()}
  });
}
function calc(){
  $("mDist").textContent="5.5 km";
  $("mPrice").textContent="90 TL";
  $("metrics").style.display="flex";
}
$("btnMenu").onclick=()=>$("drawerBack").style.display="block";
$("drawerBack").onclick=e=>{if(e.target.id==="drawerBack")e.target.style.display="none"}

$("btnRegister").onclick=()=>$("regBack").style.display="block";
function closeReg(){$("regBack").style.display="none"}
function saveReg(){
  customer={first:$("rFirst").value,last:$("rLast").value,phone:$("rPhone").value};
  if(!customer.first||!customer.last||!customer.phone)return alert("Eksik bilgi");
  save(customer);closeReg();
}

$("btnCall").onclick=async()=>{
  if(!customer)return $("regBack").style.display="block";
  $("search").style.display="block";
  await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({action:"createJob",customer_first:customer.first,customer_last:customer.last,customer_phone:customer.phone})
  });
};

init();
</script>

</body>
</html>
