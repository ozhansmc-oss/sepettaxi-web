<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SepetTaxi</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f6f7f9;
}

.hidden { display: none; }

.banner {
  background: linear-gradient(135deg, #0f172a, #020617);
  color: #fff;
  padding: 40px 20px;
}

.banner h1 {
  margin: 0 0 10px 0;
}

.banner p {
  margin: 0 0 20px 0;
  opacity: 0.9;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.primary {
  background: #e5e7eb;
}

.section {
  padding: 20px;
}

.cards {
  display: flex;
  gap: 12px;
}

.card {
  flex: 1;
  background: #fff;
  border-radius: 10px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
}

input {
  width: 100%;
  padding: 12px;
  margin-bottom: 10px;
  font-size: 15px;
}

#map {
  height: 300px;
  border-radius: 10px;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<!-- BANNER -->
<div class="banner">
  <h1>Taksi, Kurye ve Transfer â€“ Tek Platform</h1>
  <p>Åeffaf fiyat Â· CanlÄ± takip Â· Kolay kullanÄ±m</p>
  <button class="primary" onclick="showServices()">Hizmet SeÃ§</button>
</div>

<!-- HÄ°ZMET SEÃ‡Ä°M -->
<div id="services" class="section hidden">
  <div class="cards">
    <div class="card" onclick="selectService('taksi')">ğŸš•<br><b>Taksi</b></div>
    <div class="card" onclick="selectService('kurye')">ğŸ“¦<br><b>Kurye</b></div>
    <div class="card" onclick="selectService('transfer')">âœˆï¸<br><b>Transfer</b></div>
  </div>
</div>

<!-- KAYIT -->
<div id="register" class="section hidden">
  <h3>KayÄ±t</h3>
  <input id="name" placeholder="Ad Soyad">
  <input id="phone" placeholder="05XXXXXXXXX" maxlength="11">
  <button class="primary" onclick="saveUser()">Devam Et</button>
</div>

<!-- KONUM -->
<div id="location" class="section hidden">
  <h3>Konum SeÃ§imi</h3>
  <div id="map"></div>
  <button class="primary" onclick="createJob()">Ã‡aÄŸrÄ± OluÅŸtur</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* ================== AYAR ================== */
const API_URL = "https://script.google.com/macros/s/AKfycbxGK3XXKVX-65ZfRCtGhMdIoOgV6RAx7tSldcBW3ugRzB7_T3Bv2DLsCazrpLgYPwg0/exec";
/* ========================================== */

let selectedService = null;
let user = {};
let map = null;
let pickup = null;

/* Banner â†’ Hizmet */
function showServices() {
  document.getElementById("services").classList.remove("hidden");
}

/* Hizmet â†’ KayÄ±t */
function selectService(service) {
  selectedService = service;
  document.getElementById("services").classList.add("hidden");
  document.getElementById("register").classList.remove("hidden");
}

/* KayÄ±t â†’ Harita */
function saveUser() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();

  if (name.length < 3) {
    alert("Ad Soyad zorunlu");
    return;
  }

  if (!/^05\d{9}$/.test(phone)) {
    alert("Telefon 11 haneli olmalÄ± (05XXXXXXXXX)");
    return;
  }

  user = { name, phone };

  document.getElementById("register").classList.add("hidden");
  document.getElementById("location").classList.remove("hidden");

  setTimeout(initMap, 200);
}

/* Harita */
function initMap() {
  if (map) return;

  map = L.map("map").setView([40.195, 29.060], 13);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap"
  }).addTo(map);

  map.on("click", function (e) {
    pickup = e.latlng;
    L.marker(pickup).addTo(map);
  });
}

/* Ã‡aÄŸrÄ± */
function createJob() {
  if (!pickup) {
    alert("LÃ¼tfen haritadan konum seÃ§in");
    return;
  }

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      action: "createJob",
      service_type: selectedService,
      user_name: user.name,
      user_phone: user.phone,
      pickup_lat: pickup.lat,
      pickup_lng: pickup.lng
    })
  });

  alert("Talebiniz alÄ±ndÄ±");
}
</script>

</body>
</html>
