<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>SepetTaxi</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0b0f17;color:#fff}
.screen{display:none;min-height:100vh;padding:20px}
.active{display:flex;flex-direction:column}
.center{justify-content:center;align-items:center;text-align:center}

h1{font-size:36px;margin:0}
.small{color:#aaa;font-size:14px}

button{
  width:100%;
  padding:16px;
  margin-top:16px;
  border-radius:14px;
  border:none;
  font-size:16px;
  cursor:pointer;
  background:#fff;
  color:#000;
}

.list-item{
  padding:18px;
  border-bottom:1px solid #222;
  font-size:18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}

input{
  width:100%;
  padding:14px;
  margin-top:10px;
  border-radius:10px;
  border:none;
  font-size:15px;
}

#map{
  width:100%;
  height:calc(100vh - 260px);
  border-radius:12px;
  margin-top:12px;
}
</style>
</head>
<body>

<!-- 1. GÄ°RÄ°Å -->
<div id="screen1" class="screen active center">
  <h1>SepetTaxi</h1>
  <p class="small">Taksi Â· Kurye Â· Transfer</p>
  <button onclick="goTo(2)">Devam Et</button>
</div>

<!-- 2. HÄ°ZMET SEÃ‡Ä°MÄ° -->
<div id="screen2" class="screen">
  <h2>Hizmet SeÃ§</h2>
  <div class="list-item" onclick="selectService('taxi')">ğŸš• Taksi <span>â€º</span></div>
  <div class="list-item" onclick="selectService('courier')">ğŸ›µ Kurye <span>â€º</span></div>
  <div class="list-item" onclick="selectService('transfer')">âœˆï¸ Transfer <span>â€º</span></div>
</div>

<!-- 3. KAYIT -->
<div id="screen3" class="screen">
  <h2>KayÄ±t / GiriÅŸ</h2>
  <button onclick="completeRegister()">ğŸ“± Telefon ile Devam Et</button>
  <button onclick="completeRegister()">ğŸ”µ Google ile Devam Et</button>
  <button onclick="completeRegister()">ğŸ Apple ile Devam Et</button>
</div>

<!-- 4. ADRES + HARÄ°TA -->
<div id="screen4" class="screen">
  <h2 id="serviceTitle"></h2>

  <input id="from" placeholder="Nereden? (otomatik alÄ±nÄ±r)">
  <input id="to" placeholder="Nereye? (haritadan seÃ§)">

  <div id="map"></div>

  <button onclick="goTo(5)">Devam Et</button>
</div>

<!-- 5. KVKK -->
<div id="screen5" class="screen">
  <label><input type="checkbox" id="kvkk"> KVKK Metni</label><br><br>
  <label><input type="checkbox" id="sozlesme"> KullanÄ±m SÃ¶zleÅŸmesi</label>
  <button onclick="checkAgreements()">Onayla</button>
</div>

<!-- 6. ÃœCRET -->
<div id="screen6" class="screen center">
  <h2>245 TL</h2>
  <p class="small" id="summary"></p>
  <button onclick="goTo(7)">ğŸš• Ã‡aÄŸÄ±r</button>
</div>

<!-- 7. SON -->
<div id="screen7" class="screen center">
  <h2>Ã‡aÄŸrÄ± OluÅŸturuldu</h2>
  <p class="small">SÃ¼rÃ¼cÃ¼ aranÄ±yorâ€¦</p>
</div>

<script>
let selectedService=null;
let user=null;
let map, markerFrom, markerTo;

function goTo(n){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen'+n).classList.add('active');
  if(n===4) setTimeout(initMap,300);
}

function selectService(s){
  selectedService=s;
  if(!user){
    goTo(3);
  }else{
    openMap();
  }
}

function completeRegister(){
  user={id:Date.now()};
  openMap();
}

function openMap(){
  document.getElementById("serviceTitle").innerText =
    selectedService==="taxi"?"Taksi":
    selectedService==="courier"?"Kurye":"Transfer";
  goTo(4);
}

function checkAgreements(){
  if(kvkk.checked && sozlesme.checked){
    document.getElementById("summary").innerText =
      (selectedService==="taxi"?"Taksi":"Hizmet")+" Â· 7.8 km";
    goTo(6);
  }else{
    alert("Devam etmek iÃ§in onaylar gerekli.");
  }
}

function initMap(){
  if(map) return;
  map=L.map('map').setView([40.195,29.06],13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(async pos=>{
      let lat=pos.coords.latitude,lng=pos.coords.longitude;
      markerFrom=L.marker([lat,lng]).addTo(map).bindPopup("BulunduÄŸun Konum").openPopup();
      map.setView([lat,lng],14);
      from.value=await reverse(lat,lng);
    });
  }

  map.on("click",async e=>{
    let lat=e.latlng.lat,lng=e.latlng.lng;
    if(markerTo) map.removeLayer(markerTo);
    markerTo=L.marker([lat,lng]).addTo(map);
    to.value=await reverse(lat,lng);
  });
}

async function reverse(lat,lng){
  try{
    let r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
    let d=await r.json();
    return d.display_name || lat+","+lng;
  }catch{
    return lat+","+lng;
  }
}
</script>

</body>
</html>
