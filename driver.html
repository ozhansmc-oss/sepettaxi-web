<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SepetTaxi – Driver</title>
<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
header{height:56px;display:flex;align-items:center;justify-content:center;border-bottom:1px solid #222}
header span{color:#f5c400;font-weight:900}
.wrap{max-width:720px;margin:0 auto;padding:16px}
.card{background:#121212;border:1px solid #222;border-radius:14px;padding:14px;margin-bottom:12px}
input,button{width:100%;padding:14px;border-radius:12px;border:0;font-size:15px}
input{background:#1b1b1b;color:#fff;margin-bottom:10px}
button{background:#fff;color:#000;font-weight:900;margin-top:8px}
.btn-red{background:#ff4d4d;color:#000}
.btn-yellow{background:#f5c400;color:#000}
.muted{color:#aaa;font-size:13px}
</style>
</head>
<body>

<header>Sepet<span>Taxi</span> – Driver</header>

<div class="wrap">
  <div class="card">
    <input id="driverId" placeholder="Driver ID">
    <button onclick="loadJobs()">İşleri Getir</button>
  </div>

  <div id="jobs"></div>
</div>

<script>
const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxMLho3ZDX1R4EvZz-9MrOOq44807vH0MFd_X8ypSrYB6-vAQAR_dPa-lprAGkR1xsDxQ/exec";

async function api(action, data={}){
  const r = await fetch(BACKEND_URL, {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({action, ...data})
  });
  return r.json();
}

async function loadJobs(){
  const driver_id = driverId.value.trim();
  if(!driver_id) return alert("Driver ID gir");

  const jobs = await api("getJobs");
  const mine = jobs.filter(j => String(j.driver_id) === driver_id && j.status !== "completed");

  const box = document.getElementById("jobs");
  box.innerHTML = "";

  if(mine.length===0){
    box.innerHTML = `<div class="card muted">Aktif iş yok</div>`;
    return;
  }

  mine.forEach(j=>{
    const div = document.createElement("div");
    div.className="card";
    div.innerHTML = `
      <b>${j.service_type}</b><br>
      <span class="muted">${j.pickup_address} → ${j.dropoff_address}</span><br><br>
      <button class="btn-yellow" onclick="update('${j.job_id}','on_route')">Kabul Et</button>
      <button class="btn-red" onclick="reject('${j.job_id}')">Reddet</button>
      <button onclick="update('${j.job_id}','completed')">Tamamlandı</button>
    `;
    box.appendChild(div);
  });
}

async function update(job_id,status){
  await api("updateStatus",{job_id,status});
  loadJobs();
}

async function reject(job_id){
  await api("assignDriver",{job_id,driver_id:""});
  await api("updateStatus",{job_id,status:"pending"});
  loadJobs();
}
</script>
</body>
</html>
