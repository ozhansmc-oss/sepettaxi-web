<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SepetTaxi – Driver</title>
<style>
body{font-family:Arial;background:#f6f7f9;margin:0;padding:20px}
.card{background:#fff;padding:16px;border-radius:10px}
button,input{padding:10px;width:100%;margin-top:10px}
.status{margin-top:10px;font-size:14px}
</style>
</head>
<body>

<div class="card">
  <h3>Sürücü Paneli</h3>
  <input id="job" placeholder="Job ID (örn: JOB-123)">
  <button onclick="start()">Canlı Takibi Başlat</button>
  <div id="s" class="status"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxGK3XXKVX-65ZfRCtGhMdIoOgV6RAx7tSldcBW3ugRzB7_T3Bv2DLsCazrpLgYPwg0/exec";
let watchId = null;

function start(){
  const jobId = document.getElementById("job").value;
  if(!jobId) return alert("Job ID gir");

  if(!navigator.geolocation){
    alert("Konum desteklenmiyor");
    return;
  }

  watchId = navigator.geolocation.watchPosition(
    pos=>{
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      fetch(API_URL,{
        method:"POST",
        body:JSON.stringify({
          action:"updateDriverLocation",
          job_id:jobId,
          lat:lat,
          lng:lng
        })
      });

      document.getElementById("s").innerText =
        "Konum gönderiliyor: "+lat.toFixed(5)+", "+lng.toFixed(5);
    },
    err=>{
      alert("Konum hatası: "+err.message);
    },
    {
      enableHighAccuracy:true,
      maximumAge:0,
      timeout:10000
    }
  );
}
</script>

</body>
</html>
