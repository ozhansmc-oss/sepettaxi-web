<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SepetTaxi | SÃ¼rÃ¼cÃ¼ Paneli</title>

<style>
  body {
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    background: #0f0f0f;
    color: #fff;
  }
  header {
    padding: 16px;
    text-align: center;
    font-size: 18px;
    font-weight: bold;
    border-bottom: 1px solid #222;
  }
  main {
    padding: 16px;
  }
  .card {
    background: #1a1a1a;
    border-radius: 12px;
    padding: 14px;
    margin-bottom: 12px;
  }
  .row {
    font-size: 14px;
    margin-bottom: 6px;
    color: #ddd;
  }
  button {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 10px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    background: #00e676;
    color: #000;
    margin-top: 10px;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  .muted {
    text-align: center;
    color: #777;
    margin-top: 40px;
  }
</style>
</head>

<body>

<header>ðŸš• SepetTaxi â€“ SÃ¼rÃ¼cÃ¼ Paneli</header>

<main>
  <div id="jobs"></div>
  <div id="empty" class="muted" style="display:none;">
    Size atanmÄ±ÅŸ aktif iÅŸ yok.
  </div>
</main>

<script>
/* ==========================
   AYARLAR (KÄ°LÄ°TLÄ°)
========================== */
const API_URL = "https://script.google.com/macros/s/AKfycbx2SpDfLdmVu0zr1eCydbF7cPVNHEpxtY0iOmqyztRr5U84ZP8dLgREPSOPTCt9-9V9/exec";
const DRIVER_ID = "DRV-001"; // test iÃ§in sabit, login FAZ B

/* ==========================
   BAÅžLAT
========================== */
getLocation();
loadJobs();

/* ==========================
   KONUM (HAZIR)
========================== */
function getLocation(){
  if(!navigator.geolocation) return;
  navigator.geolocation.getCurrentPosition(
    pos => {
      window.driverLocation = {
        lat: pos.coords.latitude,
        lng: pos.coords.longitude
      };
    },
    err => console.warn("Konum alÄ±namadÄ±")
  );
}

/* ==========================
   Ä°ÅžLERÄ° Ã‡EK
========================== */
function loadJobs(){
  fetch(`${API_URL}?action=driverJobs&driver_id=${DRIVER_ID}`)
    .then(r=>r.json())
    .then(res=>{
      if(!res.ok) return;
      renderJobs(res.jobs || []);
    })
    .catch(()=>{});
}

/* ==========================
   Ä°ÅžLERÄ° Ã‡Ä°Z
========================== */
function renderJobs(jobs){
  const box = document.getElementById("jobs");
  const empty = document.getElementById("empty");
  box.innerHTML = "";

  if(jobs.length === 0){
    empty.style.display = "block";
    return;
  }
  empty.style.display = "none";

  jobs.forEach(j=>{
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div class="row"><b>Ä°ÅŸ No:</b> ${j.job_id}</div>
      <div class="row"><b>Hizmet:</b> ${j.service_type}</div>
      <div class="row"><b>AlÄ±m:</b> ${j.pickup_address}</div>
      <div class="row"><b>Teslim:</b> ${j.dropoff_address}</div>
      <button onclick="acceptJob('${j.job_id}')">Ä°ÅžÄ° KABUL ET</button>
    `;
    box.appendChild(div);
  });
}

/* ==========================
   Ä°Åž KABUL
========================== */
function acceptJob(jobId){
  fetch(API_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      action: "acceptJob",
      job_id: jobId,
      driver_id: DRIVER_ID
    })
  })
  .then(r=>r.json())
  .then(res=>{
    if(res.ok){
      alert("Ä°ÅŸ kabul edildi");
      loadJobs();
    }
  })
  .catch(()=>{});
}
</script>

</body>
</html>
