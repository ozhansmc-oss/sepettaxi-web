<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>SepetTaxi – Kurye</title>
  <script>
/* ===== CANLI BACKEND (CONFIG YOK) ===== */
const API = "https://script.google.com/macros/s/AKfycbxv2oWIgjckH09LB3tKOGIKox32G_RBgp6udb-sSM4uDIrL59iA8Ctsdl1cy5AC92rFZA/exec";
const POLL_MS = 3000;
</script>

<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
.card{padding:14px;border-bottom:1px solid #222}
.input,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid #222;background:#000;color:#fff}
.btn{margin:14px;background:#f5c400;color:#000;padding:14px;text-align:center;font-weight:900;border-radius:16px}
.small{font-size:12px;color:#aaa}
</style>
</head>

<body>

<div class="card">
  <select id="pkg" class="input">
    <option value="">Paket Türü</option>
    <option>Zarf</option>
    <option>Paket</option>
    <option>Koli</option>
  </select>
</div>

<div class="card">
  <textarea id="content" placeholder="Paket içeriği (zorunlu)"></textarea>
</div>

<div class="card">
  <input id="rName" class="input" placeholder="Alıcı Ad Soyad">
  <input id="rPhone" class="input" placeholder="05XXXXXXXXX" maxlength="11">
</div>

<div class="card">
  <label>
    <input type="checkbox" id="agree">
    İçerik taahhütnamesini kabul ediyorum
  </label>
</div>

<div class="btn" id="call">Kurye Çağır</div>

<script>
const route=JSON.parse(localStorage.getItem("st_temp_route")||"{}");
if(!route.from) location.href="index.html";

const $=id=>document.getElementById(id);

$("call").onclick=async()=>{
  if(
    !$("pkg").value ||
    $("content").value.trim().length<3 ||
    $("rName").value.trim().length<3 ||
    !/^05\d{9}$/.test($("rPhone").value) ||
    !$("agree").checked
  ){
    alert("Tüm alanlar zorunludur");
    return;
  }

  const payload={
    action:"createJob",
    service_type:"courier",
    from_lat:route.from.lat,
    from_lng:route.from.lng,
    to_lat:route.to.lat,
    to_lng:route.to.lng,
    distance_km:route.km,
    price_brut:route.price,
    courier:{
      pkg_type:$("pkg").value,
      content_note:$("content").value.trim(),
      recv_name:$("rName").value.trim(),
      recv_phone:$("rPhone").value.replace(/\D/g,"")
    }
  };

  const r=await fetch(SEPT.BACKEND_URL,{
    method:"POST",
    headers:{ "Content-Type":"text/plain;charset=utf-8" },
    body:JSON.stringify(payload)
  });
  const d=await r.json();
  if(d&&d.ok&&d.job_id){
    location.href="track.html?job_id="+d.job_id;
  }else{
    alert("Kurye oluşturulamadı");
  }
};
</script>
</body>
</html>
