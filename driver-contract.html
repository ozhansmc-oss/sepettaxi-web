<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>SepetTaxi – Sürücü Sözleşmesi</title>
<meta name="theme-color" content="#000000" />
<style>
  *{box-sizing:border-box}
  :root{--y:#f5c400; --line:rgba(255,255,255,.10); --mut:rgba(255,255,255,.65)}
  html,body{margin:0; background:#000; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{height:56px; display:flex; align-items:center; justify-content:center; border-bottom:1px solid rgba(255,255,255,.08)}
  header span{color:var(--y); font-weight:900}
  .wrap{padding:12px; display:flex; flex-direction:column; gap:10px}
  .card{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:12px}
  .btn{border:0; width:100%; padding:14px; border-radius:16px; font-weight:900; cursor:pointer; background:var(--y); color:#000}
  .btn[disabled]{opacity:.45; cursor:not-allowed}
  .mini{color:rgba(255,255,255,.60); font-weight:800; font-size:12px; line-height:1.45}
  .box{white-space:pre-wrap; font-family:ui-monospace,Menlo,Consolas,monospace; font-size:12px; color:rgba(255,255,255,.75); background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); padding:12px; border-radius:14px}
  label{display:flex; gap:10px; align-items:flex-start; font-weight:900}
  input[type="checkbox"]{transform:scale(1.25); margin-top:2px}
</style>
</head>
<body>
<header>Sepet<span>Taxi</span> – Sürücü Sözleşmesi</header>
<div class="wrap">
  <div class="card">
    <div class="mini">Sözleşme metinleri daha sonra finalize edilecek. Bu ekran, zorunlu onay altyapısı için hazırdır.</div>
    <div style="height:10px"></div>
    <div class="box">
[SÜRÜCÜ SÖZLEŞMESİ – TASLAK PLACEHOLDER]

1) Platform aracı rolündedir.
2) Sürücü bağımsız çalışır.
3) Komisyon oranı ve ödeme yükümlülükleri uygulanır.
4) Müşteriyle yaşanacak ihtilaflarda sorumluluk esasları.
5) Kurallara aykırılıkta yaptırımlar.
6) KVKK ve veri kullanımı.

(Metinler daha sonra eklenecek.)
    </div>
    <div style="height:12px"></div>
    <label>
      <input id="chk" type="checkbox">
      <div>Okudum, anladım ve kabul ediyorum.</div>
    </label>
    <div style="height:12px"></div>
    <button id="acceptBtn" class="btn" disabled>Onayla</button>
  </div>

  <div class="card">
    <button class="btn" style="background:rgba(255,255,255,.08);color:#fff;border:1px solid rgba(255,255,255,.12)" onclick="location.href='driver.html'">Sürücü Paneline Dön</button>
  </div>
</div>

<script>
const API = (localStorage.getItem("SEPETTAXI_API") || "https://script.google.com/macros/s/AKfycbxoeXl9XfxWtsqqCfftNV578KD_woNSKfT3KmSYwZuCv8iPSPd8-cZXNoYMh6Qx-yrlWA/exec").trim();
function ensureAPI(){ if(!API){ alert("API URL tanımlı değil. SEPETTAXI_API ayarlayın."); throw new Error("API missing"); } }
async function apiCall(action, payload){
  ensureAPI();
  const url = API + (API.includes("?") ? "&" : "?") + "action=" + encodeURIComponent(action);
  const r = await fetch(url, { method:"POST", headers:{ "Content-Type":"text/plain;charset=utf-8" }, body: JSON.stringify(payload||{}) });
  const j = await r.json();
  if(j && j.error) throw new Error(j.error);
  return j;
}
let driver=null;
try{ driver = JSON.parse(localStorage.getItem("stx_driver")||"null"); }catch(e){}
if(!driver || !driver.driver_id){
  alert("Önce sürücü olarak giriş yapın.");
  location.href="driver.html";
}

const chk = document.getElementById("chk");
const btn = document.getElementById("acceptBtn");
chk.addEventListener("change", ()=> btn.disabled = !chk.checked);

btn.addEventListener("click", async ()=>{
  try{
    await apiCall("acceptDriverContract", { driver_id: driver.driver_id });
    driver.contract_accepted = true;
    localStorage.setItem("stx_driver", JSON.stringify(driver));
    alert("Sözleşme onayı kaydedildi.");
    location.href="driver.html";
  }catch(e){
    alert("Hata: "+e.message);
  }
});
</script>
</body>
</html>
